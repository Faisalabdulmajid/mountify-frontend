"use strict";(self.webpackChunkspk_gunung=self.webpackChunkspk_gunung||[]).push([[317],{9677:(a,e,s)=>{s.r(e),s.d(e,{default:()=>m});var i=s(5043),n=s(7488),r=(s(2342),s(5016)),t=s(2555),l=s(579);const o=function(a){let{initialData:e,onUpdateSuccess:s}=a;const[r,o]=(0,i.useState)({username:"",nama_lengkap:"",email:"",domisili:"",instansi:"",nomor_telepon:""}),[c,d]=(0,i.useState)(!1);(0,i.useEffect)(()=>{e&&o({username:e.username||"",nama_lengkap:e.nama_lengkap||"",email:e.email||"",domisili:e.domisili||"",instansi:e.instansi||"",nomor_telepon:e.nomor_telepon||""})},[e]);const m=a=>{o((0,t.A)((0,t.A)({},r),{},{[a.target.name]:a.target.value}))};return(0,l.jsxs)("form",{onSubmit:async a=>{a.preventDefault(),d(!0);try{const a=localStorage.getItem("token"),e=await fetch("http://localhost:5000/api/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},credentials:"include",body:JSON.stringify(r)}),i=await e.json();if(!e.ok)throw new Error(i.message||"Gagal memperbarui profil.");n.oR.success(i.message),s&&s()}catch(e){n.oR.error(e.message)}d(!1)},className:"profil-form-card",children:[(0,l.jsx)("h3",{className:"card-title",children:"Informasi Akun"}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"username",children:"Username"}),(0,l.jsxs)("div",{className:"input-wrapper-icon",children:[(0,l.jsx)("i",{className:"bi bi-person"}),(0,l.jsx)("input",{type:"text",id:"username",name:"username",value:r.username,onChange:m,disabled:c,autoComplete:"username"})]})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"nama_lengkap",children:"Nama Lengkap"}),(0,l.jsxs)("div",{className:"input-wrapper-icon",children:[(0,l.jsx)("i",{className:"bi bi-person-badge"}),(0,l.jsx)("input",{type:"text",id:"nama_lengkap",name:"nama_lengkap",value:r.nama_lengkap,onChange:m,disabled:c})]})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"email",children:"Email"}),(0,l.jsxs)("div",{className:"input-wrapper-icon",children:[(0,l.jsx)("i",{className:"bi bi-envelope"}),(0,l.jsx)("input",{type:"email",id:"email",name:"email",value:r.email,onChange:m,disabled:c})]})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"domisili",children:"Domisili"}),(0,l.jsxs)("div",{className:"input-wrapper-icon",children:[(0,l.jsx)("i",{className:"bi bi-pin-map"}),(0,l.jsx)("input",{type:"text",id:"domisili",name:"domisili",value:r.domisili,onChange:m,disabled:c})]})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"instansi",children:"Instansi"}),(0,l.jsxs)("div",{className:"input-wrapper-icon",children:[(0,l.jsx)("i",{className:"bi bi-building"}),(0,l.jsx)("input",{type:"text",id:"instansi",name:"instansi",value:r.instansi,onChange:m,disabled:c})]})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"nomor_telepon",children:"Nomor Telepon"}),(0,l.jsxs)("div",{className:"input-wrapper-icon",children:[(0,l.jsx)("i",{className:"bi bi-telephone"}),(0,l.jsx)("input",{type:"tel",id:"nomor_telepon",name:"nomor_telepon",value:r.nomor_telepon,onChange:m,disabled:c})]})]}),(0,l.jsx)("button",{type:"submit",className:"btn-submit-profil",disabled:c,children:c?"Menyimpan...":"Simpan Perubahan"})]})};const c=function(){const[a,e]=(0,i.useState)({currentPassword:"",newPassword:"",confirmNewPassword:""}),[s,r]=(0,i.useState)({current:!1,new:!1,confirm:!1}),[o,c]=(0,i.useState)(!1),d=s=>{e((0,t.A)((0,t.A)({},a),{},{[s.target.name]:s.target.value}))},m=a=>{r(e=>(0,t.A)((0,t.A)({},e),{},{[a]:!e[a]}))};return(0,l.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),a.newPassword===a.confirmNewPassword){c(!0);try{const s=localStorage.getItem("token"),i=await fetch("http://localhost:5000/api/profile/password",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({currentPassword:a.currentPassword,newPassword:a.newPassword})}),r=await i.json();if(!i.ok)throw new Error(r.message||"Gagal memperbarui password.");n.oR.success(r.message),e({currentPassword:"",newPassword:"",confirmNewPassword:""})}catch(i){n.oR.error(i.message)}c(!1)}else n.oR.error("Password baru dan konfirmasi password tidak cocok.")},className:"profil-form-card",children:[(0,l.jsx)("h3",{className:"card-title",children:"Ubah Password"}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"currentPassword",children:"Password Saat Ini"}),(0,l.jsxs)("div",{className:"input-wrapper-icon",children:[(0,l.jsx)("button",{type:"button",className:"password-toggle-btn-left",onClick:()=>m("current"),children:(0,l.jsx)("i",{className:"bi ".concat(s.current?"bi-unlock-fill":"bi-lock-fill")})}),(0,l.jsx)("input",{type:s.current?"text":"password",id:"currentPassword",name:"currentPassword",value:a.currentPassword,onChange:d,placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0,disabled:o})]})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"newPassword",children:"Password Baru"}),(0,l.jsxs)("div",{className:"input-wrapper-icon",children:[(0,l.jsx)("button",{type:"button",className:"password-toggle-btn-left",onClick:()=>m("new"),children:(0,l.jsx)("i",{className:"bi ".concat(s.new?"bi-unlock-fill":"bi-lock-fill")})}),(0,l.jsx)("input",{type:s.new?"text":"password",id:"newPassword",name:"newPassword",value:a.newPassword,onChange:d,placeholder:"Minimal 8 karakter",required:!0,disabled:o})]})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"confirmNewPassword",children:"Konfirmasi Password Baru"}),(0,l.jsxs)("div",{className:"input-wrapper-icon",children:[(0,l.jsx)("button",{type:"button",className:"password-toggle-btn-left",onClick:()=>m("confirm"),children:(0,l.jsx)("i",{className:"bi ".concat(s.confirm?"bi-unlock-fill":"bi-lock-fill")})}),(0,l.jsx)("input",{type:s.confirm?"text":"password",id:"confirmNewPassword",name:"confirmNewPassword",value:a.confirmNewPassword,onChange:d,placeholder:"Ulangi password baru",required:!0,disabled:o})]})]}),(0,l.jsx)("button",{type:"submit",className:"btn-submit-profil",disabled:o,children:o?"Menyimpan...":"Ubah Password"})]})};const d=function(a){let{initialAvatar:e,onUpdateSuccess:s}=a;const[r,t]=(0,i.useState)(null),[o,c]=(0,i.useState)(null),[d,m]=(0,i.useState)(!1),[p,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{c(e?"http://localhost:5000".concat(e):null)},[e]);const h=()=>{u(!1)};return(0,l.jsxs)(l.Fragment,{children:[" ",(0,l.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),r){m(!0);try{const a=localStorage.getItem("token"),e=new FormData;e.append("avatar",r);const i=await fetch("http://localhost:5000/api/profile/avatar",{method:"PUT",headers:{Authorization:"Bearer ".concat(a)},body:e}),l=await i.json();if(!i.ok)throw new Error(l.message||"Gagal memperbarui avatar.");n.oR.success(l.message),t(null),s&&s()}catch(e){n.oR.error(e.message)}m(!1)}else n.oR.warn("Silakan pilih file avatar terlebih dahulu.")},className:"profil-form-card",children:[(0,l.jsx)("h3",{className:"card-title",children:"Foto Profil"}),(0,l.jsxs)("div",{className:"avatar-section-wrapper",children:[(0,l.jsx)("div",{className:"avatar-container",onClick:()=>{o&&u(!0)},title:"Klik untuk perbesar",children:o?(0,l.jsx)("img",{src:o,alt:"Avatar",className:"avatar-image"}):(0,l.jsx)("div",{className:"avatar-placeholder",children:(0,l.jsx)("i",{className:"bi bi-person-circle"})})}),(0,l.jsx)("p",{className:"avatar-instruction",children:"Klik foto untuk perbesar"}),(0,l.jsxs)("label",{htmlFor:"avatar",className:"btn-upload-label",children:[(0,l.jsx)("i",{className:"bi bi-image"}),r?r.name:"Pilih Foto Baru"]}),(0,l.jsx)("input",{type:"file",id:"avatar",name:"avatar",onChange:a=>{const e=a.target.files[0];e&&(t(e),c(URL.createObjectURL(e)))},accept:"image/*",disabled:d})]}),(0,l.jsx)("button",{type:"submit",className:"btn-submit-profil",disabled:d||!r,children:d?"Mengunggah...":"Unggah Foto"})]}),p&&(0,l.jsx)("div",{className:"modal-overlay",onClick:h,children:(0,l.jsxs)("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[(0,l.jsx)("span",{className:"modal-close-btn",onClick:h,children:"\xd7"}),(0,l.jsx)("img",{src:o,alt:"Preview Foto Profil",className:"modal-image"})]})})]})};const m=function(){const[a,e]=(0,i.useState)(null),[s,t]=(0,i.useState)(!0),{updateUser:m}=(0,r.A)(),p=async()=>{const a=localStorage.getItem("token");try{const s=await fetch("http://localhost:5000/api/profile",{headers:{Authorization:"Bearer ".concat(a)}});if(!s.ok)throw new Error("Gagal memuat ulang data pengguna.");{const a=await s.json();e(a),m(a)}}catch(s){n.oR.error(s.message)}};return(0,i.useEffect)(()=>{(async()=>{t(!0);const a=localStorage.getItem("token");if(!a)return n.oR.error("Sesi tidak valid. Silakan login kembali."),void t(!1);try{const s=await fetch("http://localhost:5000/api/profile",{headers:{Authorization:"Bearer ".concat(a)}});if(s.ok){const a=await s.json();e(a)}else n.oR.error("Gagal mengambil data profil.")}catch(s){n.oR.error("Gagal terhubung ke server.")}t(!1)})()},[]),s?(0,l.jsx)("div",{className:"loading-container",children:"Memuat data profil..."}):a?(0,l.jsxs)("div",{className:"kelola-profil-container",children:[(0,l.jsx)(n.N9,{position:"top-right",autoClose:3e3,theme:"colored",hideProgressBar:!1}),(0,l.jsxs)("header",{className:"page-header-profil",children:[(0,l.jsx)("h1",{children:"Profil Saya"}),(0,l.jsx)("p",{children:"Kelola informasi akun, password, dan foto profil Anda."})]}),(0,l.jsxs)("div",{className:"profil-content-grid",children:[(0,l.jsxs)("div",{className:"profil-main-column",children:[(0,l.jsx)(o,{initialData:a,onUpdateSuccess:p}),(0,l.jsx)(c,{})]}),(0,l.jsx)("div",{className:"profil-side-column",children:(0,l.jsx)(d,{initialAvatar:a.url_foto_profil,onUpdateSuccess:p})})]})]}):(0,l.jsx)("div",{className:"loading-container",children:"Gagal memuat data. Coba muat ulang halaman."})}}}]);
//# sourceMappingURL=317.51fb4735.chunk.js.map