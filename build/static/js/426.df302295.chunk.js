"use strict";(self.webpackChunkspk_gunung=self.webpackChunkspk_gunung||[]).push([[426],{3290:(e,a,n)=>{n.d(a,{A:()=>h});var t=n(5043),i=n(4990),s=n(954),u=n(621),l=n(64),r=n.n(l),o=n(1981),c=n.n(o),d=n(579);const m=c()(r()),g=e=>{let{editor:a}=e;const n=(0,t.useCallback)(()=>{if(!a)return;const e=a.getAttributes("link").href;m.fire({title:"Masukkan URL",input:"url",inputLabel:"Alamat URL",inputValue:e,showCancelButton:!0,confirmButtonText:"Set Link",cancelButtonText:"Batal",confirmButtonColor:"#27ae60",inputValidator:e=>{if(!e)return"Anda perlu memasukkan URL!"}}).then(e=>{e.isConfirmed&&e.value&&a.chain().focus().extendMarkRange("link").setLink({href:e.value}).run()})},[a]);return a?(0,d.jsxs)("div",{className:"tiptap-menubar",children:[(0,d.jsx)("button",{type:"button",onClick:()=>a.chain().focus().toggleBold().run(),className:a.isActive("bold")?"is-active":"",children:"Bold"}),(0,d.jsx)("button",{type:"button",onClick:()=>a.chain().focus().toggleItalic().run(),className:a.isActive("italic")?"is-active":"",children:"Italic"}),(0,d.jsx)("button",{type:"button",onClick:()=>a.chain().focus().toggleStrike().run(),className:a.isActive("strike")?"is-active":"",children:"Strike"}),(0,d.jsx)("button",{type:"button",onClick:n,className:a.isActive("link")?"is-active":"",children:"Set Link"}),(0,d.jsx)("button",{type:"button",onClick:()=>a.chain().focus().unsetLink().run(),disabled:!a.isActive("link"),children:"Unset Link"}),(0,d.jsx)("button",{type:"button",onClick:()=>a.chain().focus().setParagraph().run(),className:a.isActive("paragraph")?"is-active":"",children:"Paragraph"}),(0,d.jsx)("button",{type:"button",onClick:()=>a.chain().focus().toggleHeading({level:1}).run(),className:a.isActive("heading",{level:1})?"is-active":"",children:"H1"}),(0,d.jsx)("button",{type:"button",onClick:()=>a.chain().focus().toggleHeading({level:2}).run(),className:a.isActive("heading",{level:2})?"is-active":"",children:"H2"}),(0,d.jsx)("button",{type:"button",onClick:()=>a.chain().focus().toggleBulletList().run(),className:a.isActive("bulletList")?"is-active":"",children:"Bullet List"}),(0,d.jsx)("button",{type:"button",onClick:()=>a.chain().focus().toggleOrderedList().run(),className:a.isActive("orderedList")?"is-active":"",children:"Ordered List"})]}):null},h=e=>{let{content:a,onContentChange:n}=e;const l=(0,i.hG)({extensions:[s.A,u.Ay.configure({autolink:!0,openOnClick:!1,linkOnPaste:!0})],content:a,onUpdate:e=>{let{editor:a}=e;n(a.getHTML())},editorProps:{attributes:{class:"tiptap-prose"}}});return(0,t.useEffect)(()=>{l&&a!==l.getHTML()&&l.commands.setContent(a,!1)},[a,l]),(0,d.jsxs)("div",{className:"tiptap-container",children:[(0,d.jsx)(g,{editor:l}),(0,d.jsx)(i.$Z,{editor:l})]})}},4426:(e,a,n)=>{n.r(a),n.d(a,{default:()=>c});var t=n(2555),i=n(5043),s=n(1283),u=n(7488),l=(n(2342),n(3290)),r=n(579);const o="http://localhost:5000/api/admin";const c=function(){const e=(0,s.Zp)(),{id_pengumuman:a}=(0,s.g)(),n=Boolean(a),[c,d]=(0,i.useState)([]),[m,g]=(0,i.useState)([]),[h,p]=(0,i.useState)("umum"),[j,b]=(0,i.useState)({judul:"",isi_pengumuman:"",id_gunung:"",id_jalur:"",berlaku_mulai:"",berlaku_sampai:"",status:"Draft"}),[k,x]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{const e=localStorage.getItem("token");try{const[a,n]=await Promise.all([fetch("".concat(o,"/gunung"),{headers:{Authorization:"Bearer ".concat(e)}}),fetch("".concat(o,"/jalur"),{headers:{Authorization:"Bearer ".concat(e)}})]);if(!a.ok||!n.ok)throw new Error("Gagal memuat data relasi untuk target.");d(await a.json()),g(await n.json())}catch(a){u.oR.error(a.message)}})()},[]),(0,i.useEffect)(()=>{if(!n)return;(async()=>{x(!0);try{const e=localStorage.getItem("token"),n=await fetch("".concat(o,"/announcements/").concat(a),{headers:{Authorization:"Bearer ".concat(e)}});if(!n.ok)throw new Error("Pengumuman tidak ditemukan.");const t=await n.json(),i=e=>e?new Date(e).toISOString().split("T")[0]:"";b({judul:t.judul,isi_pengumuman:t.isi_pengumuman,id_gunung:t.id_gunung||"",id_jalur:t.id_jalur||"",berlaku_mulai:i(t.berlaku_mulai),berlaku_sampai:i(t.berlaku_sampai),status:t.status||"Draft"}),t.id_jalur?p("jalur"):t.id_gunung?p("gunung"):p("umum")}catch(n){u.oR.error(n.message),e("/admin/announcements")}finally{x(!1)}})()},[a,n,e]);const f=e=>{b(a=>(0,t.A)((0,t.A)({},a),{},{[e.target.name]:e.target.value}))};return(0,r.jsxs)("div",{className:"add-edit-pengumuman-page",children:[(0,r.jsx)(u.N9,{position:"top-right",autoClose:3e3}),(0,r.jsxs)("header",{className:"page-header",children:[(0,r.jsx)("h1",{children:n?"Edit Pengumuman":"Buat Pengumuman Baru"}),(0,r.jsxs)(s.N_,{to:"/admin/announcements",className:"btn-back",children:[(0,r.jsx)("i",{className:"bi bi-arrow-left"})," Kembali"]})]}),(0,r.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),!j.judul||!j.isi_pengumuman)return void u.oR.warn("Judul dan Isi Pengumuman wajib diisi.");if("Published"===j.status&&(!j.berlaku_mulai||!j.berlaku_sampai))return void u.oR.warn("Untuk status 'Published', rentang tanggal wajib diisi.");x(!0);const i=localStorage.getItem("token"),s=n?"".concat(o,"/announcements/").concat(a):"".concat(o,"/announcements"),l=n?"PUT":"POST";try{const a=await fetch(s,{method:l,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify(j)}),n=await a.json();if(!a.ok)throw new Error(n.message||"Operasi gagal.");u.oR.success(n.message),setTimeout(()=>e("/admin/announcements"),1500)}catch(r){u.oR.error(r.message),x(!1)}},className:"form-widget-pengumuman",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"judul",children:"Judul Pengumuman"}),(0,r.jsx)("input",{type:"text",id:"judul",name:"judul",value:j.judul,onChange:f,required:!0,disabled:k,placeholder:"cth: Penutupan Jalur Cemoro Sewu"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"isi_pengumuman",children:"Isi Pengumuman"}),(0,r.jsx)(l.A,{content:j.isi_pengumuman,onContentChange:e=>{b(a=>(0,t.A)((0,t.A)({},a),{},{isi_pengumuman:e}))}})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"status",children:"Status"}),(0,r.jsxs)("select",{id:"status",name:"status",value:j.status,onChange:f,disabled:k,children:[(0,r.jsx)("option",{value:"Draft",children:"Draft (Simpan sebagai draf)"}),(0,r.jsx)("option",{value:"Published",children:"Published (Publikasikan)"})]})]}),(0,r.jsxs)("div",{className:"form-row",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{children:"Target Pengumuman"}),(0,r.jsxs)("select",{value:h,onChange:e=>{const a=e.target.value;p(a),"umum"===a?b(e=>(0,t.A)((0,t.A)({},e),{},{id_gunung:"",id_jalur:""})):"gunung"===a&&b(e=>(0,t.A)((0,t.A)({},e),{},{id_jalur:""}))},disabled:k,children:[(0,r.jsx)("option",{value:"umum",children:"Umum (Semua Pengguna)"}),(0,r.jsx)("option",{value:"gunung",children:"Spesifik Gunung"}),(0,r.jsx)("option",{value:"jalur",children:"Spesifik Jalur"})]})]}),"gunung"===h&&(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"id_gunung",children:"Pilih Gunung"}),(0,r.jsxs)("select",{id:"id_gunung",name:"id_gunung",value:j.id_gunung,onChange:f,disabled:k,children:[(0,r.jsx)("option",{value:"",children:"-- Pilih Gunung --"}),c.map(e=>(0,r.jsx)("option",{value:e.id_gunung,children:e.nama_gunung},e.id_gunung))]})]}),"jalur"===h&&(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"id_jalur",children:"Pilih Jalur"}),(0,r.jsxs)("select",{id:"id_jalur",name:"id_jalur",value:j.id_jalur,onChange:f,disabled:k,children:[(0,r.jsx)("option",{value:"",children:"-- Pilih Jalur --"}),m.map(e=>(0,r.jsxs)("option",{value:e.id_jalur,children:[e.nama_jalur," (",e.nama_gunung,")"]},e.id_jalur))]})]})]}),(0,r.jsxs)("div",{className:"form-row",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"berlaku_mulai",children:"Berlaku Mulai"}),(0,r.jsx)("input",{type:"date",id:"berlaku_mulai",name:"berlaku_mulai",value:j.berlaku_mulai,onChange:f,disabled:k})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"berlaku_sampai",children:"Berlaku Sampai"}),(0,r.jsx)("input",{type:"date",id:"berlaku_sampai",name:"berlaku_sampai",value:j.berlaku_sampai,onChange:f,disabled:k})]})]}),(0,r.jsxs)("div",{className:"form-actions",children:[(0,r.jsx)("button",{type:"button",className:"btn-cancel",onClick:()=>e("/admin/announcements"),disabled:k,children:"Batal"}),(0,r.jsx)("button",{type:"submit",className:"btn-save",disabled:k,children:k?"Menyimpan...":"Simpan Pengumuman"})]})]})]})}}}]);
//# sourceMappingURL=426.df302295.chunk.js.map