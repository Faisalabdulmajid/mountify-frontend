{"version":3,"file":"static/js/482.26ee371e.chunk.js","mappings":"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","sources":["pages/public/LaporError/LaporError.js"],"sourcesContent":["// src/pages/public/LaporError/LaporError.js (Versi Final dengan Penanganan Error)\r\n\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { toast, ToastContainer } from \"react-toastify\";\r\nimport \"react-toastify/dist/ReactToastify.css\";\r\nimport \"./LaporError.css\";\r\n// Impor useAuth untuk logout jika diperlukan\r\nimport { useAuth } from \"../../../contexts/AuthContext\";\r\n\r\nconst API_BASE_URL = \"http://localhost:5000/api\";\r\n\r\nfunction LaporError() {\r\n  const navigate = useNavigate();\r\n  const { logout } = useAuth(); // Ambil fungsi logout dari context\r\n  const [formData, setFormData] = useState({\r\n    judul_laporan: \"\",\r\n    deskripsi_laporan: \"\",\r\n    halaman_error: \"\",\r\n  });\r\n  const [screenshot, setScreenshot] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Otomatis mengisi URL halaman saat ini\r\n    setFormData((prev) => ({ ...prev, halaman_error: window.location.href }));\r\n  }, []);\r\n\r\n  const handleChange = (e) => {\r\n    setFormData((prev) => ({ ...prev, [e.target.name]: e.target.value }));\r\n  };\r\n\r\n  const handleFileChange = (e) => {\r\n    setScreenshot(e.target.files[0]);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!formData.judul_laporan || !formData.deskripsi_laporan) {\r\n      toast.warn(\"Judul dan Deskripsi laporan wajib diisi.\");\r\n      return;\r\n    }\r\n    setIsLoading(true);\r\n\r\n    const dataToSubmit = new FormData();\r\n    dataToSubmit.append(\"judul_laporan\", formData.judul_laporan);\r\n    dataToSubmit.append(\"deskripsi_laporan\", formData.deskripsi_laporan);\r\n    dataToSubmit.append(\"halaman_error\", formData.halaman_error);\r\n    if (screenshot) {\r\n      dataToSubmit.append(\"screenshot\", screenshot);\r\n    }\r\n\r\n    const token = localStorage.getItem(\"token\");\r\n\r\n    // Menangani jika pengguna tidak login sama sekali\r\n    if (!token) {\r\n      toast.error(\"Anda harus login untuk mengirim laporan.\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/laporan-error`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: dataToSubmit,\r\n      });\r\n\r\n      // == PERBAIKAN UTAMA ADA DI SINI ==\r\n      // Cek jika response adalah 401 atau 403 (sesi tidak valid/habis)\r\n      if (response.status === 401 || response.status === 403) {\r\n        toast.error(\r\n          \"Sesi Anda tidak valid atau telah berakhir. Silakan login kembali.\"\r\n        );\r\n        logout(); // Hapus sisa token dan data pengguna dari context\r\n        setTimeout(() => navigate(\"/\"), 3000); // Arahkan ke homepage setelah 3 detik\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      const result = await response.json();\r\n      if (!response.ok) {\r\n        // Menangani error lain dari server\r\n        throw new Error(result.message || \"Gagal mengirim laporan.\");\r\n      }\r\n\r\n      toast.success(\r\n        \"Laporan berhasil dikirim. Terima kasih atas masukan Anda!\"\r\n      );\r\n      setTimeout(() => navigate(\"/\"), 2000); // Kembali ke homepage setelah berhasil\r\n    } catch (err) {\r\n      // Catch ini akan menangani error JSON.parse jika respons bukan JSON, atau error jaringan\r\n      toast.error(err.message || \"Terjadi kesalahan yang tidak terduga.\");\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"lapor-error-container\">\r\n      <ToastContainer position=\"top-center\" autoClose={3000} />\r\n      <div className=\"lapor-error-card\">\r\n        <h2>Laporkan Masalah atau Error</h2>\r\n        <p>\r\n          Menemukan sesuatu yang tidak beres? Beri tahu kami agar dapat segera\r\n          kami perbaiki.\r\n        </p>\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"judul_laporan\">Judul Laporan</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"judul_laporan\"\r\n              name=\"judul_laporan\"\r\n              value={formData.judul_laporan}\r\n              onChange={handleChange}\r\n              placeholder=\"cth: Tombol Simpan Tidak Berfungsi\"\r\n              required\r\n            />\r\n          </div>\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"deskripsi_laporan\">Deskripsi Masalah</label>\r\n            <textarea\r\n              id=\"deskripsi_laporan\"\r\n              name=\"deskripsi_laporan\"\r\n              value={formData.deskripsi_laporan}\r\n              onChange={handleChange}\r\n              rows=\"6\"\r\n              placeholder=\"Jelaskan masalah yang Anda temui, termasuk langkah-langkah untuk mereproduksinya.\"\r\n              required\r\n            />\r\n          </div>\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"halaman_error\">URL Halaman Error</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"halaman_error\"\r\n              name=\"halaman_error\"\r\n              value={formData.halaman_error}\r\n              onChange={handleChange}\r\n              readOnly\r\n            />\r\n          </div>\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"screenshot\">Screenshot (Opsional)</label>\r\n            <input\r\n              type=\"file\"\r\n              id=\"screenshot\"\r\n              name=\"screenshot\"\r\n              onChange={handleFileChange}\r\n              accept=\"image/png, image/jpeg, image/gif\"\r\n            />\r\n          </div>\r\n          <button\r\n            type=\"submit\"\r\n            className=\"btn-submit-laporan\"\r\n            disabled={isLoading}\r\n          >\r\n            {isLoading ? \"Mengirim...\" : \"Kirim Laporan\"}\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LaporError;\r\n"],"names":["navigate","useNavigate","logout","useAuth","formData","setFormData","useState","judul_laporan","deskripsi_laporan","halaman_error","screenshot","setScreenshot","isLoading","setIsLoading","useEffect","prev","_objectSpread","window","location","href","handleChange","e","target","name","value","_jsxs","className","children","_jsx","ToastContainer","position","autoClose","onSubmit","async","preventDefault","toast","warn","dataToSubmit","FormData","append","token","localStorage","getItem","error","response","fetch","concat","method","headers","Authorization","body","status","setTimeout","result","json","ok","Error","message","success","err","htmlFor","type","id","onChange","placeholder","required","rows","readOnly","files","accept","disabled"],"sourceRoot":""}