"use strict";(self.webpackChunkspk_gunung=self.webpackChunkspk_gunung||[]).push([[574],{5464:(a,e,s)=>{s.r(e),s.d(e,{default:()=>d});var i=s(5043),n=s(7488),t=(s(2342),s(2555)),r=s(579);const o=function(a){let{initialData:e}=a;const[s,o]=(0,i.useState)({nama_lengkap:"",email:"",domisili:"",instansi:"",nomor_telepon:""}),[l,c]=(0,i.useState)(!1);(0,i.useEffect)(()=>{e&&o({nama_lengkap:e.nama_lengkap||"",email:e.email||"",domisili:e.domisili||"",instansi:e.instansi||"",nomor_telepon:e.nomor_telepon||""})},[e]);const d=a=>{o((0,t.A)((0,t.A)({},s),{},{[a.target.name]:a.target.value}))};return(0,r.jsxs)("form",{onSubmit:async a=>{a.preventDefault(),c(!0);try{const a=localStorage.getItem("token"),e=await fetch("http://localhost:5000/api/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(s)}),i=await e.json();if(!e.ok)throw new Error(i.message||"Gagal memperbarui profil.");n.oR.success(i.message)}catch(e){n.oR.error(e.message)}c(!1)},className:"profil-form-card",children:[(0,r.jsx)("h3",{className:"card-title",children:"Informasi Akun"}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"nama_lengkap",children:"Nama Lengkap"}),(0,r.jsxs)("div",{className:"input-wrapper-icon",children:[(0,r.jsx)("i",{className:"bi bi-person-badge"}),(0,r.jsx)("input",{type:"text",id:"nama_lengkap",name:"nama_lengkap",value:s.nama_lengkap,onChange:d,disabled:l})]})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"email",children:"Email"}),(0,r.jsxs)("div",{className:"input-wrapper-icon",children:[(0,r.jsx)("i",{className:"bi bi-envelope"}),(0,r.jsx)("input",{type:"email",id:"email",name:"email",value:s.email,onChange:d,disabled:l})]})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"domisili",children:"Domisili"}),(0,r.jsxs)("div",{className:"input-wrapper-icon",children:[(0,r.jsx)("i",{className:"bi bi-pin-map"}),(0,r.jsx)("input",{type:"text",id:"domisili",name:"domisili",value:s.domisili,onChange:d,disabled:l})]})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"instansi",children:"Instansi"}),(0,r.jsxs)("div",{className:"input-wrapper-icon",children:[(0,r.jsx)("i",{className:"bi bi-building"}),(0,r.jsx)("input",{type:"text",id:"instansi",name:"instansi",value:s.instansi,onChange:d,disabled:l})]})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"nomor_telepon",children:"Nomor Telepon"}),(0,r.jsxs)("div",{className:"input-wrapper-icon",children:[(0,r.jsx)("i",{className:"bi bi-telephone"}),(0,r.jsx)("input",{type:"tel",id:"nomor_telepon",name:"nomor_telepon",value:s.nomor_telepon,onChange:d,disabled:l})]})]}),(0,r.jsx)("button",{type:"submit",className:"btn-submit-profil",disabled:l,children:l?"Menyimpan...":"Simpan Perubahan"})]})};const l=function(){const[a,e]=(0,i.useState)({currentPassword:"",newPassword:"",confirmNewPassword:""}),[s,o]=(0,i.useState)({current:!1,new:!1,confirm:!1}),[l,c]=(0,i.useState)(!1),d=s=>{e((0,t.A)((0,t.A)({},a),{},{[s.target.name]:s.target.value}))},m=a=>{o(e=>(0,t.A)((0,t.A)({},e),{},{[a]:!e[a]}))};return(0,r.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),a.newPassword===a.confirmNewPassword){c(!0);try{const s=localStorage.getItem("token"),i=await fetch("http://localhost:5000/api/profile/password",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({currentPassword:a.currentPassword,newPassword:a.newPassword})}),t=await i.json();if(!i.ok)throw new Error(t.message||"Gagal memperbarui password.");n.oR.success(t.message),e({currentPassword:"",newPassword:"",confirmNewPassword:""})}catch(i){n.oR.error(i.message)}c(!1)}else n.oR.error("Password baru dan konfirmasi password tidak cocok.")},className:"profil-form-card",children:[(0,r.jsx)("h3",{className:"card-title",children:"Ubah Password"}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"currentPassword",children:"Password Saat Ini"}),(0,r.jsxs)("div",{className:"input-wrapper-icon",children:[(0,r.jsx)("button",{type:"button",className:"password-toggle-btn-left",onClick:()=>m("current"),children:(0,r.jsx)("i",{className:"bi ".concat(s.current?"bi-unlock-fill":"bi-lock-fill")})}),(0,r.jsx)("input",{type:s.current?"text":"password",id:"currentPassword",name:"currentPassword",value:a.currentPassword,onChange:d,placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0,disabled:l})]})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"newPassword",children:"Password Baru"}),(0,r.jsxs)("div",{className:"input-wrapper-icon",children:[(0,r.jsx)("button",{type:"button",className:"password-toggle-btn-left",onClick:()=>m("new"),children:(0,r.jsx)("i",{className:"bi ".concat(s.new?"bi-unlock-fill":"bi-lock-fill")})}),(0,r.jsx)("input",{type:s.new?"text":"password",id:"newPassword",name:"newPassword",value:a.newPassword,onChange:d,placeholder:"Minimal 8 karakter",required:!0,disabled:l})]})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"confirmNewPassword",children:"Konfirmasi Password Baru"}),(0,r.jsxs)("div",{className:"input-wrapper-icon",children:[(0,r.jsx)("button",{type:"button",className:"password-toggle-btn-left",onClick:()=>m("confirm"),children:(0,r.jsx)("i",{className:"bi ".concat(s.confirm?"bi-unlock-fill":"bi-lock-fill")})}),(0,r.jsx)("input",{type:s.confirm?"text":"password",id:"confirmNewPassword",name:"confirmNewPassword",value:a.confirmNewPassword,onChange:d,placeholder:"Ulangi password baru",required:!0,disabled:l})]})]}),(0,r.jsx)("button",{type:"submit",className:"btn-submit-profil",disabled:l,children:l?"Menyimpan...":"Ubah Password"})]})};const c=function(a){let{initialAvatar:e,onUpdateSuccess:s}=a;const[t,o]=(0,i.useState)(null),[l,c]=(0,i.useState)(null),[d,m]=(0,i.useState)(!1),[p,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{c(e?"http://localhost:5000".concat(e):null)},[e]);const h=()=>{u(!1)};return(0,r.jsxs)(r.Fragment,{children:[" ",(0,r.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),t){m(!0);try{const a=localStorage.getItem("token"),e=new FormData;e.append("avatar",t);const i=await fetch("http://localhost:5000/api/profile/avatar",{method:"PUT",headers:{Authorization:"Bearer ".concat(a)},body:e}),r=await i.json();if(!i.ok)throw new Error(r.message||"Gagal memperbarui avatar.");n.oR.success(r.message),o(null),s&&s()}catch(e){n.oR.error(e.message)}m(!1)}else n.oR.warn("Silakan pilih file avatar terlebih dahulu.")},className:"profil-form-card",children:[(0,r.jsx)("h3",{className:"card-title",children:"Foto Profil"}),(0,r.jsxs)("div",{className:"avatar-section-wrapper",children:[(0,r.jsx)("div",{className:"avatar-container",onClick:()=>{l&&u(!0)},title:"Klik untuk perbesar",children:l?(0,r.jsx)("img",{src:l,alt:"Avatar",className:"avatar-image"}):(0,r.jsx)("div",{className:"avatar-placeholder",children:(0,r.jsx)("i",{className:"bi bi-person-circle"})})}),(0,r.jsx)("p",{className:"avatar-instruction",children:"Klik foto untuk perbesar"}),(0,r.jsxs)("label",{htmlFor:"avatar",className:"btn-upload-label",children:[(0,r.jsx)("i",{className:"bi bi-image"}),t?t.name:"Pilih Foto Baru"]}),(0,r.jsx)("input",{type:"file",id:"avatar",name:"avatar",onChange:a=>{const e=a.target.files[0];e&&(o(e),c(URL.createObjectURL(e)))},accept:"image/*",disabled:d})]}),(0,r.jsx)("button",{type:"submit",className:"btn-submit-profil",disabled:d||!t,children:d?"Mengunggah...":"Unggah Foto"})]}),p&&(0,r.jsx)("div",{className:"modal-overlay",onClick:h,children:(0,r.jsxs)("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[(0,r.jsx)("span",{className:"modal-close-btn",onClick:h,children:"\xd7"}),(0,r.jsx)("img",{src:l,alt:"Preview Foto Profil",className:"modal-image"})]})})]})};const d=function(){const[a,e]=(0,i.useState)(null),[s,t]=(0,i.useState)(!0),d=async()=>{const a=localStorage.getItem("token");try{const s=await fetch("http://localhost:5000/api/profile",{headers:{Authorization:"Bearer ".concat(a)}});if(!s.ok)throw new Error("Gagal memuat ulang data pengguna.");{const a=await s.json();e(a)}}catch(s){n.oR.error(s.message)}};return(0,i.useEffect)(()=>{(async()=>{t(!0);const a=localStorage.getItem("token");if(!a)return n.oR.error("Sesi tidak valid. Silakan login kembali."),void t(!1);try{const s=await fetch("http://localhost:5000/api/profile",{headers:{Authorization:"Bearer ".concat(a)}});if(s.ok){const a=await s.json();e(a)}else n.oR.error("Gagal mengambil data profil.")}catch(s){n.oR.error("Gagal terhubung ke server.")}t(!1)})()},[]),s?(0,r.jsx)("div",{className:"loading-container",children:"Memuat data profil..."}):a?(0,r.jsxs)("div",{className:"halaman-profil-saya-container",children:[(0,r.jsx)(n.N9,{position:"top-right",autoClose:3e3,theme:"colored",hideProgressBar:!1}),(0,r.jsxs)("header",{className:"page-header-profil",children:[(0,r.jsx)("h1",{children:"Profil Saya"}),(0,r.jsx)("p",{children:"Kelola informasi akun, password, dan foto profil Anda."})]}),(0,r.jsxs)("div",{className:"profil-content-grid",children:[(0,r.jsxs)("div",{className:"profil-main-column",children:[(0,r.jsx)(o,{initialData:a,onUpdateSuccess:d}),(0,r.jsx)(l,{})]}),(0,r.jsx)("div",{className:"profil-side-column",children:(0,r.jsx)(c,{initialAvatar:a.url_foto_profil,onUpdateSuccess:d})})]})]}):(0,r.jsx)("div",{className:"loading-container",children:"Gagal memuat data. Coba muat ulang halaman."})}}}]);
//# sourceMappingURL=574.e8e1a745.chunk.js.map