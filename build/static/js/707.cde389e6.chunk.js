"use strict";(self.webpackChunkspk_gunung=self.webpackChunkspk_gunung||[]).push([[707],{2562:(a,e,n)=>{n.d(e,{A:()=>s});n(5043);var i=n(1283),t=n(579);const s=a=>{let{title:e,backText:n,backLink:s}=a;return(0,t.jsxs)("header",{className:"page-header",children:[(0,t.jsx)("h1",{children:e}),(0,t.jsxs)(i.N_,{to:s,className:"btn-back",children:[(0,t.jsx)("i",{className:"bi bi-arrow-left"})," ",n]})]})}},2917:(a,e,n)=>{n.d(e,{A:()=>o});const i="https://www.emsifa.com/api-wilayah-indonesia/api",t="/provinces.json",s="/regencies",r="/districts",o={async getProvinces(){try{const a=await fetch("".concat(i).concat(t));if(!a.ok)throw new Error("Gagal memuat data provinsi");return await a.json()}catch(a){throw console.error("Error fetching provinces:",a),a}},async getRegencies(a){try{const e=await fetch("".concat(i).concat(s,"/").concat(a,".json"));if(!e.ok)throw new Error("Gagal memuat kabupaten untuk provinsi ".concat(a));return await e.json()}catch(e){throw console.error("Error fetching regencies for province ".concat(a,":"),e),e}},async getDistricts(a){try{const e=await fetch("".concat(i).concat(r,"/").concat(a,".json"));if(!e.ok)throw new Error("Gagal memuat kecamatan untuk kabupaten ".concat(a));return await e.json()}catch(e){throw console.error("Error fetching districts for regency ".concat(a,":"),e),e}},async getRegenciesForMultipleProvinces(a){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{const n=a.map(async a=>{var n;const i=await this.getRegencies(a),t=(null===(n=e.find(e=>e.id===a))||void 0===n?void 0:n.name)||"";return i.map(e=>({id:e.id,name:e.name,province_id:a,province_name:t}))});return(await Promise.all(n)).flat()}catch(n){throw console.error("Error fetching regencies for multiple provinces:",n),n}},parseStoredLocation:a=>a?a.split("; ").map(a=>{const e=a.split(", ");return{regency:e[0],province:e[1]}}):[],formatLocationForStorage(a){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a.map(a=>{const n=e.find(e=>e.id===a);return n?"".concat(n.name,", ").concat(n.province_name):""}).filter(Boolean)}}},4223:(a,e,n)=>{n.r(e),n.d(e,{default:()=>u});var i=n(2555),t=n(5043),s=n(1283),r=n(7488),o=(n(2342),n(2562)),l=n(2917),c=n(579);const d="http://localhost:5000",m={MAX_FILE_SIZE:5242880,ALLOWED_FILE_TYPES:["image/jpeg","image/jpg","image/png","image/webp"],MIN_NAME_LENGTH:3,MAX_HEIGHT:9e3,REDIRECT_DELAY:1500};const u=function(){const a=(0,s.Zp)(),[e,n]=(0,t.useState)({nama_gunung:"",ketinggian_puncak_mdpl:"",lokasi_administratif:[],deskripsi_singkat:""}),[u,g]=(0,t.useState)(""),[p,h]=(0,t.useState)(""),[k,f]=(0,t.useState)(""),[b,x]=(0,t.useState)([]),[v,j]=(0,t.useState)([]),[_,w]=(0,t.useState)([]),[y,N]=(0,t.useState)(!1),[E,S]=(0,t.useState)(!1),[T,A]=(0,t.useState)(!1),[R,L]=(0,t.useState)(null),[C,P]=(0,t.useState)(null),[I,D]=(0,t.useState)(!1),[G,M]=(0,t.useState)(!1),[F,K]=(0,t.useState)(""),B=a=>{const{name:e,value:t}=a.target;n(a=>(0,i.A)((0,i.A)({},a),{},{[e]:t})),M(!0)};(0,t.useEffect)(()=>{(async()=>{N(!0);try{const a=await l.A.getProvinces();w(a)}catch(a){console.error("Error fetching provinsi:",a),r.oR.error("Gagal memuat data provinsi. Silakan refresh halaman."),w([{id:"32",name:"Jawa Barat"},{id:"33",name:"Jawa Tengah"},{id:"35",name:"Jawa Timur"},{id:"52",name:"Nusa Tenggara Barat"},{id:"51",name:"Bali"},{id:"34",name:"DI Yogyakarta"},{id:"31",name:"DKI Jakarta"}])}finally{N(!1)}})()},[]),(0,t.useEffect)(()=>{(async()=>{try{const a=await fetch("".concat(d,"/api/csrf-token"),{credentials:"include"});if(a.ok){const e=await a.json();K(e.csrfToken)}}catch(a){}})()},[]),(0,t.useEffect)(()=>{const a=a=>{G&&(a.preventDefault(),a.returnValue="")};return window.addEventListener("beforeunload",a),()=>window.removeEventListener("beforeunload",a)},[G]);const H=a=>a?a.toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"";return(0,c.jsxs)("div",{className:"add-gunung-page",children:[(0,c.jsx)(r.N9,{position:"top-right",autoClose:3e3,hideProgressBar:!1}),(0,c.jsx)(o.A,{title:"Tambah Data Gunung Baru",backText:"Kembali ke Daftar",backLink:"/admin/gunung"}),(0,c.jsxs)("form",{onSubmit:async n=>{if(n.preventDefault(),!e.nama_gunung.trim()||!e.ketinggian_puncak_mdpl)return void r.oR.warn("Nama Gunung dan Ketinggian wajib diisi.");const i=parseInt(e.ketinggian_puncak_mdpl,10);if(i<0||i>m.MAX_HEIGHT)return void r.oR.warn("Ketinggian harus antara 0-".concat(m.MAX_HEIGHT," MDPL."));if(e.nama_gunung.trim().length<m.MIN_NAME_LENGTH)return void r.oR.warn("Nama gunung minimal ".concat(m.MIN_NAME_LENGTH," karakter."));D(!0);const t=new FormData,s=H(e.nama_gunung),o=e.lokasi_administratif.join("; ");t.append("nama_gunung",s),t.append("lokasi_administratif",o),t.append("ketinggian_puncak_mdpl",e.ketinggian_puncak_mdpl),t.append("deskripsi_singkat",e.deskripsi_singkat),R&&t.append("url_thumbnail",R);try{const e=localStorage.getItem("token"),n=await fetch("".concat(d,"/api/admin/gunung"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"X-CSRF-Token":F},body:t,credentials:"include"}),i=await n.json();if(!n.ok)throw new Error(i.message||"Gagal menambahkan data gunung.");r.oR.success("Data gunung baru berhasil ditambahkan!"),M(!1),setTimeout(()=>a("/admin/gunung"),m.REDIRECT_DELAY)}catch(l){r.oR.error(l.message||"Terjadi kesalahan saat menyimpan data.")}finally{D(!1)}},className:"form-widget-gunung",children:[(0,c.jsxs)("fieldset",{className:"form-fieldset",disabled:I,children:[(0,c.jsx)("legend",{children:"Informasi Dasar Gunung"}),(0,c.jsx)("div",{className:"form-row",children:(0,c.jsxs)("div",{className:"form-group full-width",children:[(0,c.jsx)("label",{htmlFor:"url_thumbnail",children:"Foto Utama / Thumbnail"}),(0,c.jsx)("div",{className:"foto-upload-container",onClick:()=>document.getElementById("url_thumbnail").click(),children:C?(0,c.jsx)("img",{src:C,alt:"Preview",className:"foto-preview"}):(0,c.jsxs)("div",{className:"foto-placeholder",children:[(0,c.jsx)("i",{className:"bi bi-image-alt"}),(0,c.jsx)("p",{children:"Pilih Foto"})]})}),(0,c.jsx)("input",{type:"file",id:"url_thumbnail",name:"url_thumbnail",onChange:a=>{const e=a.target.files[0];if(e){if(!m.ALLOWED_FILE_TYPES.includes(e.type))return r.oR.error("Format file tidak didukung. Gunakan JPG, PNG, atau WebP."),void(a.target.value="");if(e.size>m.MAX_FILE_SIZE)return r.oR.error("Ukuran file terlalu besar. Maksimal 5MB."),void(a.target.value="");L(e),P(URL.createObjectURL(e)),M(!0)}else L(null),P(null)},accept:"image/*",style:{display:"none"}})]})}),(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"nama_gunung",children:"Nama Gunung"}),(0,c.jsx)("input",{type:"text",id:"nama_gunung",name:"nama_gunung",value:e.nama_gunung,onChange:B,required:!0,placeholder:"Contoh: Gunung Ciremai"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"ketinggian_puncak_mdpl",children:"Ketinggian (MDPL)"}),(0,c.jsx)("input",{type:"number",id:"ketinggian_puncak_mdpl",name:"ketinggian_puncak_mdpl",value:e.ketinggian_puncak_mdpl,onChange:B,required:!0,placeholder:"Contoh: 3078"})]})]}),(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsxs)("label",{htmlFor:"provinsi",children:["Provinsi",(0,c.jsx)("small",{style:{display:"block",color:"#666",fontSize:"12px",marginTop:"4px"},children:"Pilih provinsi untuk menambah lokasi administratif"})]}),(0,c.jsxs)("select",{id:"provinsi",name:"provinsi",value:u,onChange:async a=>{const e=a.target.value;if(g(e),h(""),f(""),x([]),j([]),e){S(!0);try{const a=await l.A.getRegencies(parseInt(e));x(a)}catch(n){console.error("Error fetching kabupaten:",n),r.oR.error("Gagal memuat data kabupaten.")}finally{S(!1)}M(!0)}},className:"form-select",disabled:y,children:[(0,c.jsx)("option",{value:"",children:y?"Memuat data provinsi...":"Pilih Provinsi"}),_.map(a=>(0,c.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsxs)("label",{htmlFor:"kabupaten",children:["Kabupaten/Kota",(0,c.jsx)("small",{style:{display:"block",color:"#666",fontSize:"12px",marginTop:"4px"},children:"Pilih kabupaten setelah memilih provinsi"})]}),(0,c.jsxs)("select",{id:"kabupaten",name:"kabupaten",value:p,onChange:async a=>{const e=a.target.value;if(h(e),f(""),j([]),e){A(!0);try{const a=await l.A.getDistricts(parseInt(e));j(a)}catch(n){console.error("Error fetching kecamatan:",n),r.oR.error("Gagal memuat data kecamatan.")}finally{A(!1)}M(!0)}},className:"form-select",disabled:!u||E,children:[(0,c.jsx)("option",{value:"",children:E?"Memuat data kabupaten...":u?"Pilih Kabupaten/Kota":"Pilih provinsi terlebih dahulu"}),b.map(a=>(0,c.jsx)("option",{value:a.id,children:a.name},a.id))]})]})]}),(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsxs)("label",{htmlFor:"kecamatan",children:["Kecamatan (Opsional)",(0,c.jsx)("small",{style:{display:"block",color:"#666",fontSize:"12px",marginTop:"4px"},children:"Pilih kecamatan untuk detail lokasi yang lebih spesifik"})]}),(0,c.jsxs)("select",{id:"kecamatan",name:"kecamatan",value:k,onChange:a=>{const e=a.target.value;f(e),M(!0)},className:"form-select",disabled:!p||T,children:[(0,c.jsx)("option",{value:"",children:T?"Memuat data kecamatan...":p?"Pilih Kecamatan (Opsional)":"Pilih kabupaten terlebih dahulu"}),v.map(a=>(0,c.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,c.jsx)("div",{className:"form-group",style:{display:"flex",alignItems:"flex-end"},children:(0,c.jsxs)("button",{type:"button",onClick:()=>{var a,t,s;if(!u||!p)return void r.oR.warn("Pilih provinsi dan kabupaten terlebih dahulu.");const o=(null===(a=_.find(a=>a.id===u))||void 0===a?void 0:a.name)||"",l=(null===(t=b.find(a=>String(a.id)===String(p)))||void 0===t?void 0:t.name)||"";if(!l)return void r.oR.warn("Nama kabupaten tidak ditemukan. Silakan pilih ulang kabupaten.");const c=k&&(null===(s=v.find(a=>a.id===parseInt(k)))||void 0===s?void 0:s.name)||"";let d="";d=c?"Kec. ".concat(c,", ").concat(l,", ").concat(o):"".concat(l,", ").concat(o);if(e.lokasi_administratif.some(a=>{const e=a.match(/([^,]+), ([^,]+)$/);if(!e)return!1;const[,n,i]=e;return n.trim()===l&&i.trim()===o}))return void r.oR.warn("Kabupaten ini sudah ditambahkan untuk provinsi yang sama.");const m=[...e.lokasi_administratif,d];n(a=>(0,i.A)((0,i.A)({},a),{},{lokasi_administratif:m})),g(""),h(""),f(""),x([]),j([]),M(!0)},className:"btn-add-location",disabled:!u||!p,style:{backgroundColor:"#0369a1",color:"white",border:"none",borderRadius:"6px",padding:"12px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"background-color 0.2s",marginTop:"24px",minHeight:"44px"},onMouseEnter:a=>{a.target.disabled||(a.target.style.backgroundColor="#0284c7")},onMouseLeave:a=>{a.target.disabled||(a.target.style.backgroundColor="#0369a1")},children:[(0,c.jsx)("i",{className:"bi bi-plus-circle"}),"Tambah Lokasi"]})})]}),(0,c.jsx)("div",{className:"form-row",children:(0,c.jsxs)("div",{className:"form-group full-width",children:[(0,c.jsxs)("label",{children:["Lokasi Administratif Terpilih",(0,c.jsx)("small",{style:{display:"block",color:"#666",fontSize:"12px",marginTop:"4px"},children:"Daftar lokasi administratif yang akan disimpan untuk gunung ini"})]}),(0,c.jsxs)("div",{className:"selected-locations",children:[0===e.lokasi_administratif.length?(0,c.jsxs)("div",{style:{color:"#999",fontStyle:"italic",margin:"12px 0",padding:"16px",backgroundColor:"#f8fafc",borderRadius:"6px",border:"1px dashed #cbd5e1",textAlign:"center"},children:[(0,c.jsx)("i",{className:"bi bi-geo-alt",style:{fontSize:"24px",marginBottom:"8px",display:"block"}}),"Belum ada lokasi administratif yang ditambahkan.",(0,c.jsx)("br",{}),"Gunakan dropdown di atas untuk menambah lokasi."]}):(0,c.jsx)("div",{className:"location-tags",children:e.lokasi_administratif.map((a,t)=>{let s="",r="";const o=/^([^,]+), ([^,]+)$/,l=a.match(/^Kec\. ([^,]+), ([^,]+), ([^,]+)$/);if(l)r=l[1],s=l[2];else{const e=a.match(o);e&&(s=e[1])}return(0,c.jsxs)("div",{className:"location-tag enhanced",children:[(0,c.jsxs)("div",{className:"location-info",children:[(0,c.jsx)("i",{className:"bi bi-geo-alt-fill",style:{color:"#0369a1",marginRight:"6px"}}),(0,c.jsx)("span",{className:"location-text",children:a}),r&&(0,c.jsxs)("span",{style:{marginLeft:8,color:"#0a0",fontSize:12},children:[(0,c.jsx)("b",{children:"Kec:"})," ",r," | ",(0,c.jsx)("b",{children:"Kab:"})," ",s]})]}),(0,c.jsx)("button",{type:"button",onClick:()=>(a=>{const t=[...e.lokasi_administratif];t.splice(a,1),n(a=>(0,i.A)((0,i.A)({},a),{},{lokasi_administratif:t})),M(!0)})(t),className:"remove-location",title:"Hapus lokasi ini",children:(0,c.jsx)("i",{className:"bi bi-x-lg"})})]},t)})}),e.lokasi_administratif.length>0&&(0,c.jsxs)("div",{style:{marginTop:"12px",padding:"8px 12px",backgroundColor:"#ecfdf5",border:"1px solid #a7f3d0",borderRadius:"6px",fontSize:"12px",color:"#047857"},children:[(0,c.jsx)("i",{className:"bi bi-info-circle-fill",style:{marginRight:"6px"}}),"Total ",e.lokasi_administratif.length," lokasi administratif akan disimpan."]})]})]})}),(0,c.jsx)("div",{className:"form-row",children:(0,c.jsxs)("div",{className:"form-group full-width",children:[(0,c.jsx)("label",{htmlFor:"deskripsi_singkat",children:"Deskripsi Singkat"}),(0,c.jsx)("textarea",{id:"deskripsi_singkat",name:"deskripsi_singkat",rows:"4",value:e.deskripsi_singkat,onChange:B,placeholder:"Deskripsi umum dan singkat mengenai gunung..."})]})})]}),(0,c.jsxs)("div",{className:"form-actions",children:[(0,c.jsx)("button",{type:"button",className:"btn-cancel",onClick:()=>{G?window.confirm("Anda memiliki perubahan yang belum disimpan. Yakin ingin keluar?")&&a("/admin/gunung"):a("/admin/gunung")},disabled:I,children:"Batal"}),(0,c.jsx)("button",{type:"submit",className:"btn-save",disabled:I,children:I?"Menyimpan...":"Simpan Data Gunung"})]})]})]})}}}]);
//# sourceMappingURL=707.cde389e6.chunk.js.map