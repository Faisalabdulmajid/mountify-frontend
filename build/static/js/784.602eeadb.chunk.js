"use strict";(self.webpackChunkspk_gunung=self.webpackChunkspk_gunung||[]).push([[784],{698:(e,n,a)=>{a.d(n,{A:()=>t});a(5043);var s=a(579);const t=e=>{let{title:n,onAddClick:a,addLabel:t="Tambah",addIcon:i=(0,s.jsx)("i",{className:"bi bi-plus-lg"}),children:l}=e;return(0,s.jsxs)("div",{className:"controls-container",children:[(0,s.jsxs)("div",{className:"header-row",children:[(0,s.jsx)("h1",{className:"page-title",children:n}),a&&(0,s.jsxs)("button",{className:"btn-add-new",onClick:a,children:[i," ",t]})]}),l]})}},2062:(e,n,a)=>{a.d(n,{A:()=>t});a(5043);var s=a(579);const t=e=>{let{currentPage:n,totalPages:a,itemsPerPage:t,totalItems:i,onPageChange:l,onItemsPerPageChange:r,indexOfFirstItem:c,currentItemsLength:d}=e;const o=e=>{e>0&&e<=a&&l(e)};return(0,s.jsxs)("div",{className:"pagination",children:[(0,s.jsxs)("div",{className:"pagination-info",children:[(0,s.jsx)("span",{children:"Baris per halaman:"}),(0,s.jsxs)("select",{value:t,onChange:e=>{r(parseInt(e.target.value,10))},className:"items-per-page-select",children:[(0,s.jsx)("option",{value:5,children:"5"}),(0,s.jsx)("option",{value:10,children:"10"}),(0,s.jsx)("option",{value:20,children:"20"}),(0,s.jsx)("option",{value:50,children:"50"}),(0,s.jsx)("option",{value:100,children:"100"})]}),(0,s.jsxs)("span",{style:{marginLeft:"15px"},children:["Menampilkan ",d>0?c+1:0,"-",c+d," dari ",i," data"]})]}),(0,s.jsxs)("div",{className:"pagination-controls",children:[(0,s.jsx)("button",{onClick:()=>o(n-1),disabled:1===n,children:"Sebelumnya"}),(0,s.jsxs)("span",{children:["Halaman ",n," dari ",a||1]}),(0,s.jsx)("button",{onClick:()=>o(n+1),disabled:n===a||0===a,children:"Selanjutnya"})]})]})}},4784:(e,n,a)=>{a.r(n),a.d(n,{default:()=>u});var s=a(5043),t=a(1283),i=a(64),l=a.n(i),r=(a(6681),a(7488)),c=(a(2342),a(5071)),d=(a(9645),a(2062)),o=a(579);const h="http://localhost:5000";const u=function(){const e=(0,t.Zp)(),[n,a]=(0,s.useState)([]),[i,u]=(0,s.useState)(!0),[m,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{u(!0),g(null);try{const e=localStorage.getItem("token");if(!e)throw new Error("Akses ditolak. Silakan login kembali.");const n=await fetch("".concat(h,"/api/admin/users"),{headers:{Authorization:"Bearer ".concat(e)}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Gagal mengambil data pengguna.")}const s=(await n.json()).map(e=>({id_user:e.id_user,name:e.nama_lengkap,username:e.username,email:e.email,peran:e.peran,status:e.status,joinedDate:e.created_at,avatar:e.url_foto_profil||"",nomor_telepon:e.nomor_telepon,domisili:e.domisili,instansi:e.instansi}));a(s)}catch(m){console.error("Error fetching users:",m),g(m.message)}finally{u(!1)}})()},[]);const[x,j]=(0,s.useState)(""),[p,k]=(0,s.useState)("Semua"),[v,b]=(0,s.useState)(1),[w,f]=(0,s.useState)(5),N=(0,s.useMemo)(()=>n.filter(e=>{const n=x.toLowerCase(),a=e.name.toLowerCase().includes(n)||e.email.toLowerCase().includes(n)||e.username&&e.username.toLowerCase().includes(n)||e.nomor_telepon&&e.nomor_telepon.includes(x)||e.domisili&&e.domisili.toLowerCase().includes(n)||e.instansi&&e.instansi.toLowerCase().includes(n),s="Semua"===p||e.peran===p;return a&&s}),[n,x,p]),C=v*w,S=C-w,y=N.slice(S,C),A=Math.ceil(N.length/w),P=async e=>{const s=n.find(n=>n.id_user===e);if(!s)return void r.oR.error("Pengguna tidak ditemukan!");if((await l().fire({title:"Hapus Pengguna?",text:"Apakah Anda yakin ingin menghapus pengguna: ".concat(s.name,"?"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed)try{const n=localStorage.getItem("token");if(!n)return g("Akses ditolak. Sesi Anda mungkin telah berakhir."),void r.oR.error("Akses ditolak. Sesi Anda mungkin telah berakhir.");const s=await(async()=>{try{const e=await fetch("".concat(h,"/api/csrf-token"),{credentials:"include"});if(!e.ok)throw new Error("Gagal mengambil CSRF token");return(await e.json()).csrfToken}catch(e){return null}})();if(!s)return void r.oR.error("Gagal mengambil CSRF token.");const t=await fetch("".concat(h,"/api/admin/users/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(n),"X-CSRF-Token":s},credentials:"include"}),i=await t.json();if(!t.ok)throw new Error(i.message||"Gagal menghapus pengguna.");r.oR.success(i.message||"Pengguna berhasil dihapus."),a(n=>n.filter(n=>n.id_user!==e))}catch(m){console.error("Error deleting user:",m),g(m.message),r.oR.error(m.message||"Terjadi kesalahan saat menghapus pengguna.")}},_=localStorage.getItem("peran");return(0,o.jsxs)("div",{className:"user-management-page",children:[(0,o.jsx)(c.zY,{title:"Manajemen Pengguna",addLabel:"superadmin"===_||"admin"===_?"Tambah Pengguna Baru":void 0,onAddClick:()=>e("/admin/users/new"),children:(0,o.jsxs)("div",{className:"toolbar",children:[(0,o.jsxs)("div",{className:"search-container",children:[(0,o.jsx)("i",{className:"bi bi-search"}),(0,o.jsx)("input",{type:"text",placeholder:"Cari (nama, email, username, no.telp, domisili, instansi)...",value:x,onChange:e=>{j(e.target.value),b(1)}})]}),(0,o.jsxs)("select",{value:p,onChange:e=>{k(e.target.value),b(1)},children:[(0,o.jsx)("option",{value:"Semua",children:"Semua Peran"}),(0,o.jsx)("option",{value:"superadmin",children:"Super Admin"}),(0,o.jsx)("option",{value:"admin",children:"Admin"}),(0,o.jsx)("option",{value:"user",children:"User"})]})]})}),(0,o.jsx)("div",{className:"table-container",children:(0,o.jsxs)("table",{className:"user-table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{width:"18%"},children:(0,o.jsx)("div",{className:"header-cell-content",children:(0,o.jsx)("span",{children:"Pengguna"})})}),(0,o.jsx)("th",{style:{width:"12%"},children:(0,o.jsx)("div",{className:"header-cell-content",children:(0,o.jsx)("span",{children:"No. Telepon"})})}),(0,o.jsx)("th",{style:{width:"12%"},children:(0,o.jsx)("div",{className:"header-cell-content",children:(0,o.jsx)("span",{children:"Domisili"})})}),(0,o.jsx)("th",{style:{width:"12%"},children:(0,o.jsx)("div",{className:"header-cell-content",children:(0,o.jsx)("span",{children:"Instansi"})})}),(0,o.jsx)("th",{style:{width:"10%"},children:(0,o.jsx)("div",{className:"header-cell-content",children:(0,o.jsx)("span",{children:"Peran"})})}),(0,o.jsx)("th",{style:{width:"10%"},children:(0,o.jsx)("div",{className:"header-cell-content",children:(0,o.jsx)("span",{children:"Status"})})}),(0,o.jsx)("th",{style:{width:"12%"},children:(0,o.jsx)("div",{className:"header-cell-content",children:(0,o.jsx)("span",{children:"Bergabung"})})}),(0,o.jsx)("th",{style:{width:"14%"},children:"Aksi"})]})}),(0,o.jsx)("tbody",{children:i?(0,o.jsx)("tr",{children:(0,o.jsx)("td",{colSpan:"9",style:{textAlign:"center",padding:"20px"},children:"Memuat data pengguna..."})}):m?(0,o.jsx)("tr",{children:(0,o.jsxs)("td",{colSpan:"9",style:{textAlign:"center",padding:"20px",color:"red"},children:["Error: ",m]})}):y.length>0?y.map(n=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("div",{className:"user-info-cell",children:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"user-name",children:n.name}),(0,o.jsx)("div",{className:"user-email",children:n.email})]})})}),(0,o.jsx)("td",{children:n.nomor_telepon||"-"}),(0,o.jsx)("td",{children:n.domisili||"-"}),(0,o.jsx)("td",{children:n.instansi||"-"}),(0,o.jsx)("td",{children:n.peran}),(0,o.jsx)("td",{children:(0,o.jsx)("span",{className:"status-badge status-".concat(n.status.toLowerCase().replace(" ","-")),children:n.status})}),(0,o.jsx)("td",{children:new Date(n.joinedDate).toLocaleDateString("id-ID")}),(0,o.jsx)("td",{children:"superadmin"===_||"admin"===_?(0,o.jsxs)("div",{className:"action-buttons",children:[(0,o.jsx)("button",{className:"action-btn btn-edit",onClick:()=>e("/admin/users/edit/".concat(n.id_user)),children:(0,o.jsx)("i",{className:"bi bi-pencil-fill"})}),(0,o.jsx)("button",{className:"action-btn btn-delete",onClick:()=>P(n.id_user),children:(0,o.jsx)("i",{className:"bi bi-trash-fill"})})]}):(0,o.jsx)("span",{style:{color:"#aaa",fontSize:"12px"},children:"-"})})]},n.id_user)):(0,o.jsx)("tr",{children:(0,o.jsx)("td",{colSpan:"9",style:{textAlign:"center",padding:"20px"},children:"Tidak ada pengguna yang cocok dengan kriteria Anda."})})})]})}),(0,o.jsx)(r.N9,{position:"top-right",autoClose:3e3}),(0,o.jsx)(d.A,{currentPage:v,totalPages:A,itemsPerPage:w,totalItems:N.length,onPageChange:e=>b(e),onItemsPerPageChange:e=>{f(e),b(1)},indexOfFirstItem:S,currentItemsLength:y.length})]})}},5071:(e,n,a)=>{a.d(n,{zY:()=>s.A});var s=a(698);a(5043),a(579)},6681:()=>{},9645:()=>{}}]);
//# sourceMappingURL=784.602eeadb.chunk.js.map